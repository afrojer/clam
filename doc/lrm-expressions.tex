\section{Expressions}
\label{sec:expressions}

\subsection{Primary Expressions}
\label{ssec:primaryexpresions}
identifiers, constants, strings. The type of the expressions depends on the identifier, constant or string.

\subsection{Unary Operators}
\label{ssec:unaryoperators}
There are two unary operators in \sys{}, and they are only used with a
numeric-valued operand such as a numeric constant
(see~\ref{sssec:numericconstants}).
These expressions are grouped right-to-left:
\startsyn
\texttt{+}\emph{numeric-expression} \\
\texttt{-}\emph{numeric-expression}
\stopsyn

\subsubsection{\texttt{+} operator}
This operator forces the value of its numeric operand to be positive.
The resulting expression is of numeric type with a value equal to the
absolute value of the numeric operand.

\subsubsection{\texttt{-} operator}
This operator forces the value of its numeric operand to be negative.
The resulting expression is of numeric type with a value equal to the
negative of the numeric operand.

\subsection{Channel/Calc Expresions}
\label{ssec:channelexpressions}
\texttt{Channel} and \texttt{Calc} types are the basis of \texttt{Image} and
\texttt{Kernel} objects respectively. There are several operators that
manipulate \texttt{Channel}s and \texttt{Calc}s.

\subsubsection{\texttt{:} operator}
\label{sssec:colonop}
Extract or use an individual \texttt{Channel} in an image.
\startsyn
\emph{image-identifier}\texttt{:}\emph{channel-identifier}
\stopsyn
The resulting expression has a type corresponding to the
extracted \texttt{Channel}.

\subsubsection{\texttt{\$()} operator}
\label{sssec:evalop}
This operator forces the evaluation of a previously defined \texttt{Image}
\texttt{Channel}. It is generally used in the context of a convolution operation.
\startsyn
\texttt{\$(}\emph{channel-expression}\texttt{)}
\stopsyn
The resulting expression has a type corresponding to the
calculated \texttt{Channel}.

\subsection{Composition Operators}
\label{ssec:compositionops}
These operators compose an \texttt{Image} from one or more \texttt{Channels}.
All channel composition operators are left-to-right associative.

\subsubsection{\texttt{|} operator}
\label{sssec:barop}
Compose two (or more) \texttt{Channel}s or \texttt{Calc}s. The resulting expression is a
\emph{multi-channel-expression}, or \emph{multi-calc} expression, and can be assigned
to either an \texttt{Image} or a \texttt{Kernel} object respectively.
\startsyn
\emph{channel-expression} \texttt{|} \emph{channel-expression} \\
\emph{multi-channel-expression} \texttt{|} \emph{channel-expression} \\
\emph{calc-expression} \texttt{|} \emph{calc-expression} \\
\emph{multi-calc-expression} \texttt{|} \emph{calc-expression} \\
\stopsyn
Note that \texttt{Channel}s and \texttt{Calc}s are appended in order, and
subsequent operations may rely on this order.

\comment{
\subsubsection{\texttt{||} operator}
\label{sssec:doublebarop}
Compose two (or more) \texttt{Channel}s. The resulting expression is a
\emph{multi-channel-expression}, and can be assigned to either an \texttt{Image}
or a \texttt{Kernel} object. This operator differs from the \texttt{|} operator in that
it forces the serial computation of channel values. This allows subsequent channel
value calculations to use neighboring pixels of previously calculated channels.
\startsyn
\emph{channel-expression} \texttt{||} \emph{channel-expression} \\
\emph{multi-channel-expression} \texttt{||} \emph{channel-expression}
\stopsyn
} % END comment (save this for later...)

\subsection{\texttt{**} operator}
\label{ssec:convolutionop}

The convlution operator, or \texttt{**}, performs the calculations of a
\texttt{Kernel} on an \texttt{Image}, and evaluates to a new \texttt{Image}.
When the \texttt{Kernel} is evaluated, as many operations as possible are
parallelized to improve performance.

Parallelized calculations may depend on each other as long as the
dependent calculation is listed second when the \texttt{Kernel} is
defined, and the dependent calculation does not depend on more than
the current pixel of the required calculation.

Any channels that are marked with an \texttt{@} symbol are transient and
are not added to the result \texttt{Image}.

\subsection{Escaped ``C'' Expression}
\label{ssec:escapedC}

Escaped ``C'' expressions can be used on the right side of the \texttt{:=}
when defining a \texttt{Channel}. The escaped code must be a single expression
in C that will evaluate to the equivalent type as the \texttt{Channel} in C.
The expression should not end in a semicolon.

The equivalent types are:

\begin{center}\begin{tabular}{l | l}
\sys type & equivalent C type \\
\hline
Uint8  & char \\
Uint16 & int \\
Uint32 & long \\
Angle  & double \\
Float  & double
\end{tabular}\end{center}

When the channel described by an escaped ``C'' expression must be evaluated,
every pixel in the channel is calculated by evaluating the C expression.
When the expression is evaluated, every identifier corresponding to
another channel in the image appears will be replaced by the value of the
pixel in the same location for that channel. Thus, if the C expression
contains the identifier \texttt{Red}, then when the channel is calculated
it will replace \texttt{Red} in the expression with the appropriate value
from the \texttt{Red} channel.

Standard C operators are available for use, as well as \texttt{sqrt} and
\texttt{exp}.

\subsection{I/O Expressions}

\subsubsection{\texttt{imgread} expression}
\label{sssec:imgread}
The \texttt{imgread} expression reads in an \texttt{Image} object from
a known image format located on the file system. The expression results
in an \texttt{Image} object which can be assigned using the \texttt{=}
operator (see section~\ref{sssec:equalop}). The resulting \texttt{Image}
object has 3 \texttt{Channel}s named \emph{Red}, \emph{Green}, and
\emph{Blue}. Each of the channels correspond to the red, green, and blue
image data read into the \texttt{Image} object. This expression is invoked
as a ``C'' style function, and expects 1 parameter: the path of the image
file to read.
\startsyn
\texttt{imgread(} \emph{string-constant} \texttt{)}
\stopsyn

\subsubsection{\texttt{imgwrite} expression}
\label{sssec:imgwrite}
The \texttt{imgwrite} expression writes out an \texttt{Image} object to a known
image format. It requires that the \texttt{Image} object has at least 3 named
\texttt{Channels}: \emph{Red}, \emph{Green}, and \emph{Blue}.
This expression has no type (null type), and is invoked as a ``C'' style function.
It expects 3 parameters: the first parameter is an \texttt{Image} identifier, the
second is the image format, and the the third is the path to which the image
should be written.
\startsyn
\texttt{imgwrite(} \emph{image-identifier} \texttt{,} \emph{string-constant} \texttt{,} \emph{string-constant} \texttt{)}
\stopsyn

\subsection{Assignment Expressions}
\label{ssec:assignment}

\subsubsection{\texttt{=} assignment operator}
\label{sssec:equalop}
Assigns the value of the right operand to the left operand, copying data as necessary.
The types of both operands must match.

\subsubsection{\texttt{:=} assignment operator}
\label{sssec:colonequalop}
Assigns a calculation constant (see section~\ref{sssec:calcconstants}), or
escaped ``C'' expression (see section~\ref{ssec:escapedC}) to a \texttt{Calc}
object.

\subsubsection{\texttt{|=} assignment operator}
\label{sssec:barequalop}
Add a \texttt{Channel} or a \texttt{Calc} object to an \texttt{Image} or
\texttt{Kernel} object. Assignments using this operator are ordered by statement
order, and subsequent operations can rely on this order.

Note that a \texttt{Calc} object assigned to an \texttt{Image} object must be
evaluated using the \texttt{\$()} operator (see section~\ref{sssec:evalop}) before
being using in calculation or further assignment.

\comment{
\subsubsection{\texttt{\^=} assignment operator}
} % END comment - save for later...
